{% extends 'bills/Base.html' %}
{% load crispy_forms_tags %}
{% block invoice_form %}


<div class="container">

    <div class="row alert alertbg mt-2 text-center">
        <div class="col-sm-2"><a href="{% url 'customer_dashboard' id %}" class="btn btn-primary mt-2" ><i class="bi bi-house-door"></i> Home</a></div>
        <div class="col-sm-8 mt-2"><h4 class="">Generate Invoice</h4></div>
      <div class="col-sm-2"><a href="" class="btn btn-primary mt-2" data-toggle="modal" data-target="#ModelCalculator"><i class="bi bi-calculator"></i> Calculator</a></div>
      </div>
    
    <form action="" method="post">{% csrf_token %}
    <h6 class="form_heading mt-2" >Customer Details</h6>
    <div class="row">
        <div class="col-sm-6">{{fm.cust_name|as_crispy_field}}</div>
        <div class="col-sm-6">{{fm.cust_mobile|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-4">{{fm.cust_village|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.cust_taluka|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.cust_dist|as_crispy_field}}</div>
    </div>

    <h6 class="form_heading mt-3">Basic Information</h6>
    <div class="row">
        <div class="col-sm-4">{{fm.inv_no|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.inv_date|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.other_reference|as_crispy_field}} {{fm.inv_amt_in_word.as_hidden}}</div>
    </div>

    <h6 class="form_heading mt-3">Bill Details</h6>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_1|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_1|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_1|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_1|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_1|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_1|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_2|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_2|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_2|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_2|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_2|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_2|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_3|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_3|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_3|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_3|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_3|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_3|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_4|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_4|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_4|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_4|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_4|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_4|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_5|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_5|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_5|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_5|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_5|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_5|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-3">{{fm.inv_description_6|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_chessis_6|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_engine_6|as_crispy_field}}</div>
        <div class="col-sm-1">{{fm.inv_qty_6|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_rate_6|as_crispy_field}}</div>
        <div class="col-sm-2">{{fm.inv_amount_6|as_crispy_field}}</div>
    </div>
    
    <h6 class="form_heading mt-3">Finel Details</h6>
    <div class="row">
        <div class="col-sm-4">{{fm.inv_sub_total|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.inv_sgst|as_crispy_field}}</div>
        <div class="col-sm-4">{{fm.inv_cgst|as_crispy_field}}</div>
    </div>
    <div class="row">
        <div class="col-sm-6">{{fm.inv_rto|as_crispy_field}}</div>
        <div class="col-sm-6">{{fm.inv_grand_total|as_crispy_field}}</div>
    </div>

    <div class="row text-center">
        <div class="col-sm-12">
        <input type="submit" value="Generate Invoice" class="btn btnbg px-5 py-2">
    </div>
    </div>
</form>
    <hr>
</div>




<!-- Modal -->
<div class="modal fade" id="ModelCalculator" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLongTitle">Get Actual Amount From GST Amount</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            
            {{calculator.Before_Amount|as_crispy_field}}
            {{calculator.CGST_Amount|as_crispy_field}}
            {{calculator.SGST_Amount|as_crispy_field}}
            {{calculator.After_Amount|as_crispy_field}}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  



<script>
    function auto_calculations(value)
    {
    qty1=Number(document.getElementById('id_inv_qty_1').value);
    rate1=Number(document.getElementById('id_inv_rate_1').value);
    multi1=qty1*rate1;
    amt1=Number(document.getElementById('id_inv_amount_1').value=multi1);
     
    qty2=Number(document.getElementById('id_inv_qty_2').value);
    rate2=Number(document.getElementById('id_inv_rate_2').value);
    multi2=qty2*rate2;
    amt2=Number(document.getElementById('id_inv_amount_2').value=multi2);
       
    qty3=Number(document.getElementById('id_inv_qty_3').value);
    rate3=Number(document.getElementById('id_inv_rate_3').value);
    multi3=qty3*rate3;
    amt3=Number(document.getElementById('id_inv_amount_3').value=multi3);
       
    qty4=Number(document.getElementById('id_inv_qty_4').value);
    rate4=Number(document.getElementById('id_inv_rate_4').value);
    multi4=qty4*rate4;
    amt4=Number(document.getElementById('id_inv_amount_4').value=multi4);
       
    qty5=Number(document.getElementById('id_inv_qty_5').value);
    rate5=Number(document.getElementById('id_inv_rate_5').value);
    multi5=qty5*rate5;
    amt5=Number(document.getElementById('id_inv_amount_5').value=multi5);
       
    qty6=Number(document.getElementById('id_inv_qty_6').value);
    rate6=Number(document.getElementById('id_inv_rate_6').value);
    multi6=qty6*rate6;
    amt6=Number(document.getElementById('id_inv_amount_6').value=multi6);

    calculation_subtotal=amt1+amt2+amt3+amt4+amt5+amt6;

    subtotal=Number(document.getElementById('id_inv_sub_total').value=calculation_subtotal);

    calculation_sgst=(subtotal*6)/100;
    calculation_cgst=(subtotal*6)/100;

    sgst=Number(document.getElementById('id_inv_sgst').value=calculation_sgst);
    cgst=Number(document.getElementById('id_inv_cgst').value=calculation_cgst);
    
    rto=Number(document.getElementById('id_inv_rto').value);

    calculation_total=calculation_subtotal+sgst+cgst+rto;

    total=Number(document.getElementById('id_inv_grand_total').value=calculation_total);
    }




function ConvertNumberToWords(value) {
    value = Number(document.getElementById('id_inv_grand_total').value);
        var words = new Array();
        words[0] = '';
        words[1] = 'One';
        words[2] = 'Two';
        words[3] = 'Three';
        words[4] = 'Four';
        words[5] = 'Five';
        words[6] = 'Six';
        words[7] = 'Seven';
        words[8] = 'Eight';
        words[9] = 'Nine';
        words[10] = 'Ten';
        words[11] = 'Eleven';
        words[12] = 'Twelve';
        words[13] = 'Thirteen';
        words[14] = 'Fourteen';
        words[15] = 'Fifteen';
        words[16] = 'Sixteen';
        words[17] = 'Seventeen';
        words[18] = 'Eighteen';
        words[19] = 'Nineteen';
        words[20] = 'Twenty';
        words[30] = 'Thirty';
        words[40] = 'Forty';
        words[50] = 'Fifty';
        words[60] = 'Sixty';
        words[70] = 'Seventy';
        words[80] = 'Eighty';
        words[90] = 'Ninety';
        number = value.toString();
        var atemp = number.split(".");
        var number = atemp[0].split(",").join("");
        var n_length = number.length;
        var words_string = "";
        if (n_length <= 9) {
            var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
            var received_n_array = new Array();
            for (var i = 0; i < n_length; i++) {
                received_n_array[i] = number.substr(i, 1);
            }
            for (var i = 9 - n_length, j = 0; i < 9; i++ , j++) {
                n_array[i] = received_n_array[j];
            }
            for (var i = 0, j = 1; i < 9; i++ , j++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    if (n_array[i] == 1) {
                        n_array[j] = 10 + parseInt(n_array[j]);
                        n_array[i] = 0;
                    }
                }
            }
            value = "";
            for (var i = 0; i < 9; i++) {
                if (i == 0 || i == 2 || i == 4 || i == 7) {
                    value = n_array[i] * 10;
                } else {
                    value = n_array[i];
                }
                if (value != 0) {
                    words_string += words[value] + " ";
                }
                if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Crores ";
                }
                if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Lakhs ";
                }
                if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                    words_string += "Thousand ";
                }
                if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                    words_string += "Hundred and ";
                } else if (i == 6 && value != 0) {
                    words_string += "Hundred ";
                }
            }
            words_string = words_string.split("  ").join(" ");
        }
        document.getElementById('id_inv_amt_in_word').value = words_string;
    }
</script>


<script>
    function gst_calculator(value)
{
    GST_Amount=Number(document.getElementById('id_Before_Amount').value);
    get_gst_free_amount=GST_Amount/112*12
    cgst=get_gst_free_amount/2
    sgst=get_gst_free_amount/2
    Actual_Amount=GST_Amount-get_gst_free_amount
    Number(document.getElementById('id_CGST_Amount').value=cgst);
    Number(document.getElementById('id_SGST_Amount').value=sgst);
    Number(document.getElementById('id_After_Amount').value=Actual_Amount);

}
</script>




<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <script>
    {% for msg in messages %}
    swal("Done", "{{msg}}", "success");
  {% endfor %}
  </script>


{% endblock invoice_form %}